<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://kit.fontawesome.com/429a22e70e.js" crossorigin="anonymous"></script>
<div class="gridWrapper">
  <!--
  Div with photo and data of the user
  -->
  <div class="userData">
    <img src="{{currentUser?.profile_photo}}" class="userImage"/>
    <ul>
      <li><span class="nameData">{{currentUser?.last_name+" "+currentUser?.first_name}}</span></li>
      <li><span class="otherData">{{currentUser?.email}}</span></li>
      <li><span class="otherData">{{currentUser?.city}}</span></li>
      <li><span class="otherData">{{currentUser?.birth_date}}</span></li>
    </ul>
  </div>

  <!--
  Div with accordeon
  -->
  <div class="accordeon">
    <div class="accordeonItemList">
      <span class="accordeonItem" id="accordeonItem0" (click)="changePanel(0)">Мої події</span>
      <span class="accordeonItem" id="accordeonItem1" (click)="changePanel(1)">Майбутні</span>
      <span class="accordeonItem" id="accordeonItem2" (click)="changePanel(2)">Профіль</span>
    </div>



    <div class="accordeonContainer">
  <!--
  Div with events
  -->

      <div class="eventList" *ngIf="status===0 || status===1">
        <div *ngFor="let ev of this.eventList" class="eventListItem">
            <img class="eventPhoto" src="{{ev.event_photo}}">
            <span class="eventName">{{ev.event_name}}</span>
            <span class="eventOtherData">
              <span class="eventDuration">
                <img src="./assets/images/clock_duration_icon.svg" alt="" class='icon' />
                            {{calculateDuration(ev)}}</span>
              <span class="eventTime">{{ev.event_datetime_begin | date:'EEE, MMM d, HH:mm'}} -
                {{ev.event_datetime_end | date:'EEE, MMM d, HH:mm'}}</span>
              <span class="eventLocation">
                <img src="./assets/images/location_icon.svg" alt="" class='icon'/>
                {{ev.event_location}}</span>
            </span>

        </div>
      </div>
      <div class='userUpdateFormWrapper' *ngIf="status===2">

        <!-- <p>value: {{ form.value | json }}</p> -->
        <!-- <p>the whole form status: {{ form.status | json }} , {{form.valid}}</p> -->
        <!-- <p>PASSWORD status: {{ form.get('password').status | json }} , {{form.get('password').valid}}</p> -->
        <!-- <p>Confirm status: {{ form.get('confirm_password').status | json }} , {{form.get('confirm_password').valid}}</p> -->
        <!-- <p>errors: {{ form.get('password').errors | json }}</p> -->
      
        <form [formGroup]="form" action="" (ngSubmit)="updateUser()" class="userUpdateForm">
          <div class="grid-profile">
            <div class="container">
              <div class="userUpdateFormInputs">
                <!-- <img class="updatePhoto" src="{{this.url}}" alt="" /> -->
              <p class="update_enter_label cont1">
  
                <label for="profile_photo">Фото профілю</label>
                <button class="updatePhotoButton" (click)="userButtonClick()">Вибрати фото профілю</button>
                <input type='file' (change)="readUrl($event)">
  
                <!-- <input id="profile_photo" class="updatePhotoInput" type="file" accept=".jpg, .jpeg, .png" [(ngModel)]="this.imagePath" formControlName="profile_photo"/> -->
              </p>
                <!-- First name -->
                <p class="update_enter_label cont1">
                  <label for="firstname">Ім'я: </label>
                  <input autofocus type="text" id="firstname" formControlName="firstname" class="input_reg" />
                </p>
                <div *ngIf="f.firstname.touched && f.firstname.errors">
                  <div *ngIf="f.firstname.errors.required" class=" invalid-data"><small>Це поле обов'язкове для заповнення</small>
                </div>
                  <div class="valid">
                  <div class=" invalid-data" *ngIf="f.firstname.errors.pattern">Неправильний формат</div>
                </div>
                </div>
                <!--  -->
  
                <!-- Last name -->
                <p class="update_enter_label cont1">
                  <label for="lastname">Прізвище: </label>
                  <input type="text" id="lastname" formControlName="lastname" class="input_reg" />
                </p>
                <div *ngIf="f.lastname.touched && f.lastname.errors">
                  <div *ngIf="f.lastname.errors.required" class=" invalid-data">Це поле обов'язкове для заповнення</div>
                  <div class=" invalid-data" *ngIf="f.lastname.errors.pattern">Неправильний формат</div>
                </div>
              
                <!--  -->
  
                <!-- Date of birth -->
                <p class="update_enter_label cont1 ">
                  <label for="date">Дата народження: </label>
                  <input type="date" id="date" formControlName="date"  [(ngModel)]="updatedUser.birth_date" class="input_reg " />
                </p>
                <!--  -->
              
                <!-- City -->
                <div class="update_enter_label cont1" >
                  <label for="city">Місто проживання: </label>
                  <input type="text" id="city" formControlName="city" class="input_reg" (focusin)="autoCompleteActive = true;" (ngModelChange)="updateSelectedCities();"/>
                  <div id="autocomplete-items" class="autocomplete-items" *ngIf="this.autoCompleteActive === true">
                    <div class="autocomplete-item-container" (focusin)="autoCompleteActive = true;" (focusout)=" autoCompleteActive = false;">
                      <div *ngFor="let city of selectedCities;" class="autocomplete-item" (click)='autoCompleteActive = true;setCity(city);' (focusout)="this.autoCompleteActive = false;" >
                        {{city}}
                      </div>
                    </div>
                  </div>
                </div>
  
                <div *ngIf=" f.city.touched && (f.city.errors || this.autoCompleteChosen===false)">
                  <!-- <div *ngIf="f.city.errors.required" class=" invalid-data">Це поле обов'язкове для заповнення</div> -->
                  <div class=" invalid-data" *ngIf="this.autoCompleteChosen===false">Виберіть місто з випадаючого списку</div>
                  <!-- <div class=" invalid-data" *ngIf="f.city.errors">Неправильний формат</div> -->
                </div>
                <!--  -->
  
  
                <p class="update_enter_label cont1">
                  <label for="sex">Cтать:</label>
                  <select id="sex"  formControlName="sex">
                    <option [value]="'not_specified'" >Не вказано</option>
                    <option [value]="'male'" >Чоловіча</option>
                    <option [value]="'female'" >Жіноча</option>
                  </select>
                </p>
              </div>
                <div class="grid-profile">
                  <!-- Old password -->
                <p class="update_enter_label">
                  <label for="old_password">Старий пароль(У разі зміни паролю) </label>
                  <input type="password" id="old_password" formControlName="old_password" class="input_reg"  />
                </p>
                <div *ngIf="newPass!=='' && oldPass.length<8 ">
                  <!-- <div *ngIf="f.city.errors.required" class=" invalid-data">Це поле обов'язкове для заповнення</div> -->
                  <div class=" invalid-data" >Оскільки ви хочете змінити пароль, то введіть старий</div>
                  <!-- <div class=" invalid-data" *ngIf="f.city.errors">Неправильний формат</div> -->
                </div>
  
                <!-- New password -->
                <p class="update_enter_label">
                  <label for="password">Введіть новий пароль: </label>
                  <input type="password" id="password" formControlName="new_password" class="input_reg" />
                </p>
                <div *ngIf="newPass!='' && (newPass.length<8 || newPass.length>12)">
                  <!-- <div *ngIf="f.city.errors.required" class=" invalid-data">Це поле обов'язкове для заповнення</div> -->
                  <div class=" invalid-data">Новий пароль має бути від 8 до 12 символів</div>
                  <!-- <div class=" invalid-data" *ngIf="f.city.errors">Неправильний формат</div> -->
                </div>
  
                <!-- Confirm password -->
                <p class="update_enter_label">
                  <label for="confirm_password">Введіть новий пароль повторно: </label>
                  <input type="password" id="confirm_password" formControlName="confirm_password"
                         class="input_reg" autocomplete="off"/>
                </p>
                <div *ngIf=" this.newPass.length>0 && this.newPass!==this.confPass">
                  <!-- <div *ngIf="f.city.errors.required" class=" invalid-data">Це поле обов'язкове для заповнення</div> -->
                  <div class=" invalid-data ">Введений та підтверджений паролі не збігаються</div>
                  <!-- <div class=" invalid-data" *ngIf="f.city.errors">Неправильний формат</div> -->
                </div>
  
                <!-- <div>{{form.errors|json}}</div> -->
  
                <p class="update_enter_label">
                  <label for="pets">Чи є у Вас домашні улюбленці, які ?</label>
                  <input type="text" id="pets" formControlName="pets" class="input_reg" /></p>
                <p class="update_enter_label ">
                  <label for="family_status">Сімейний стан:</label>
                  <select id="family_status" formControlName="family_status">
                    <option [value]="'single'" >Не одружений/не заміжня</option>
                    <option [value]="'married'" >Одружений/заміжня</option>
                    <option [value]="'in relationship'" >В стосунках</option>
                  </select>
                </p>
  
              </div>
            </div>
            
            <div class="loader">
              <img src="assets/images/loadanimation.svg" *ngIf="loading==true" class="loading-image">
            </div>
            <div class="update_enter_label wrapp">
              <button type="submit" [disabled]="form.invalid || loading===true || this.passwordMatcher()===false" class=" update_button_position update_button "
                      (click)="updateUser()">Оновити</button>
            </div>
            <div class="update_enter_label wrapp">
              <button [disabled]="loading===true" type="button" (click)="this.resetUser()" class=" update_button_position update_button ">Повернути</button>
            </div>
          
          </div>
        </form>
       
    </div>
    </div>
  </div>
</div>